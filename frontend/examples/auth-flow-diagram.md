# Authentication Flow Diagram

## Complete Authentication Flow

```
┌─────────────────────────────────────────────────────────────────┐
│                        APP STARTUP/REFRESH                      │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    AuthProvider Initialization                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 1. Check for refresh token in cookies                   │   │
│  │ 2. If found: Call /auth/refresh API                     │   │
│  │ 3. If success: Store accessToken in Redux               │   │
│  │ 4. If failed: Clear auth data                           │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                        APP READY                               │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ • Access token available in Redux store                │   │
│  │ • User can make authenticated requests                  │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                      API REQUEST FLOW                          │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    prepareHeaders Function                      │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 1. Get accessToken from Redux store                     │   │
│  │ 2. Check if token is expired                            │   │
│  │ 3. If valid: Add "Authorization: Bearer {token}"        │   │
│  │ 4. If expired: Don't add header                         │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                      Make API Request                          │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    Handle Response                              │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ • Success (200): Return data                            │   │
│  │ • Error (401): Trigger token refresh logic             │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                   401 ERROR HANDLING                           │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                  Check Endpoint Type                           │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ • Auth endpoints (login/register): Return error         │   │
│  │ • Other endpoints: Try token refresh                     │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    Token Refresh Process                       │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 1. Get refresh token from cookies                        │   │
│  │ 2. Call /auth/refresh API                                │   │
│  │ 3. If success: Update accessToken in Redux               │   │
│  │ 4. Retry original request with new token                 │   │
│  │ 5. If failed: Clear auth data & redirect to login        │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                      Request Success                           │
└─────────────────────────────────────────────────────────────────┘
